DROP TABLE IF EXISTS ACTIVITY_LOG; DROP TABLE IF EXISTS REPORT; DROP TABLE IF EXISTS NETWORK_NODE; DROP TABLE IF EXISTS WORKPLACE;
CREATE TABLE IF NOT EXISTS WORKPLACE ( id BIGINT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(100) NOT NULL, icon_key VARCHAR(40) NULL, location VARCHAR(120) NULL, summary VARCHAR(200) NULL, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP );
CREATE TABLE IF NOT EXISTS NETWORK_NODE ( id BIGINT PRIMARY KEY AUTO_INCREMENT, workplace_id BIGINT NOT NULL, parent_id BIGINT NULL, node_type VARCHAR(20) NOT NULL, display_name VARCHAR(120) NOT NULL, meta_json VARCHAR(2000) NULL, sort_order INT NOT NULL DEFAULT 0, CONSTRAINT fk_node_workplace FOREIGN KEY (workplace_id) REFERENCES WORKPLACE(id) );
CREATE INDEX IF NOT EXISTS idx_node_wp_parent_sort ON NETWORK_NODE(workplace_id, parent_id, sort_order);
CREATE TABLE IF NOT EXISTS ACTIVITY_LOG ( id BIGINT PRIMARY KEY AUTO_INCREMENT, node_id BIGINT NOT NULL, occurred_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, title VARCHAR(200) NOT NULL, content CLOB NULL, CONSTRAINT fk_log_node FOREIGN KEY (node_id) REFERENCES NETWORK_NODE(id) );
CREATE INDEX IF NOT EXISTS idx_log_node_time ON ACTIVITY_LOG(node_id, occurred_at DESC);
CREATE TABLE IF NOT EXISTS REPORT ( id BIGINT PRIMARY KEY AUTO_INCREMENT, workplace_id BIGINT NOT NULL, report_date DATE NULL, title VARCHAR(200) NOT NULL, content CLOB NULL, author VARCHAR(80) NULL, tags_csv VARCHAR(300) NULL, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL, CONSTRAINT fk_report_workplace FOREIGN KEY (workplace_id) REFERENCES WORKPLACE(id) );
CREATE INDEX IF NOT EXISTS idx_report_wp_created ON REPORT(workplace_id, created_at DESC); CREATE INDEX IF NOT EXISTS idx_report_wp_date ON REPORT(workplace_id, report_date DESC);
